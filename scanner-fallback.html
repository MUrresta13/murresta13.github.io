<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="manifest" href="./manifest.webmanifest">
<title>Hunt Scanner â€” Photo</title>
<style>
  :root { --bg:#000; --fg:#f2f5f9; --accent:#ff6a00; }
  *{box-sizing:border-box} html,body{height:100%;margin:0;background:#000;color:var(--fg);font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:24px}
  .card{width:min(720px,92vw);background:rgba(255,255,255,.06);border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:18px;box-shadow:0 12px 28px rgba(0,0,0,.45)}
  h1{margin:8px 0 12px;font-size:1.2rem}
  .btn{-webkit-tap-highlight-color:transparent; border:0; border-radius:12px; padding:12px 14px; font-weight:800; background:linear-gradient(135deg, var(--accent), #ff9f1a); color:#111; box-shadow:0 8px 18px rgba(255,106,0,.35);}
  .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
  #preview{width:100%;max-height:60vh;object-fit:contain;background:#000;border-radius:12px;margin-top:10px}
  .meta{opacity:.9;margin-top:8px}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>ðŸŽƒ Hunt Scanner â€” Photo</h1>
    <p class="meta">Take a photo of a QR code, or choose one from your library. Weâ€™ll decode it and open the link here.</p>
    <div class="row">
      <label class="btn">
        <input id="file" type="file" accept="image/*" capture="environment" style="display:none">
        Take / Choose Photo
      </label>
      <button id="openBtn" class="btn" disabled>Open Link</button>
    </div>
    <img id="preview" alt="preview">
    <div id="status" class="meta"></div>
    <canvas id="canvas" style="display:none"></canvas>
  </div>
</div>

<!-- jsQR via CDN -->
<script src="https://cdn.jsdelivr.net/npm/jsqr@1.4.0/dist/jsQR.min.js"></script>
<script>
const fileInput = document.getElementById('file');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const preview = document.getElementById('preview');
const statusEl = document.getElementById('status');
const openBtn = document.getElementById('openBtn');
let lastUrl = null;

function status(msg){ statusEl.textContent = msg; }

fileInput.addEventListener('change', async (e)=>{
  const file = e.target.files[0];
  if(!file) return;
  status('Loading imageâ€¦');
  const img = new Image();
  img.onload = ()=>{
    canvas.width = img.naturalWidth;
    canvas.height = img.naturalHeight;
    ctx.drawImage(img, 0, 0);
    preview.src = img.src;
    decode();
  };
  img.onerror = ()=> status('Could not load image.');
  img.src = URL.createObjectURL(file);
});

function decode(){
  try {
    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
    const result = jsQR(imageData.data, imageData.width, imageData.height, { inversionAttempts: 'attemptBoth' });
    if (result && result.data){
      lastUrl = result.data;
      status('QR found. Ready to open.');
      openBtn.disabled = false;
    } else {
      status('No QR found. Try a clearer photo (good lighting, fill the frame).');
      openBtn.disabled = true;
    }
  } catch(e){
    status('Decoding error.');
    openBtn.disabled = true;
  }
}

openBtn.addEventListener('click', ()=>{
  if(lastUrl){
    location.href = lastUrl;
  }
});
</script>
</body>
</html>
