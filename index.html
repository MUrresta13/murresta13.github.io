<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<title>QR Clue ‚Äî Halloween Hunt</title>

<!-- PWA (full-screen like Amazon) -->
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#000000">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="üéÉ Hunt Scanner">
<link rel="apple-touch-icon" href="/icons/icon-192.png">

<style>
  :root{ --bg:#0b0f14; --text:#f3f6fb; --accent:#ff6a00; }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}

  .layer{position:fixed; inset:0; display:flex; align-items:center; justify-content:center; padding:24px; min-height:100svh; min-height:100dvh;}
  .layer::after{ content:""; position:fixed; left:0; right:0; bottom:0; height:env(safe-area-inset-bottom); background:#000; pointer-events:none; }

  #gate{background: radial-gradient(1200px 700px at 50% -10%, #111627 0%, #0b0f14 60%);}
  #player{background:#000; display:none;}
  #content{background:#000; display:none; opacity:0; filter:blur(6px); transform:translateY(6px);
           transition:opacity 1.2s ease, filter 1.2s ease, transform 1.2s ease;}
  #content.reveal{opacity:1; filter:blur(0); transform:translateY(0);}

  .card{ width:min(820px,92vw); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
    border-radius:16px; padding:20px; text-align:center; box-shadow:0 12px 28px rgba(0,0,0,.45); }
  .title{font-size:1.35rem; font-weight:900; margin-bottom:8px}
  .meta{opacity:.92; margin:.25rem 0 1rem}
  .btn{ -webkit-tap-highlight-color:transparent; display:inline-flex; align-items:center; gap:10px;
    padding:14px 18px; border:0; border-radius:14px; font-weight:800; font-size:1.05rem;
    color:#1a1a1a; background:linear-gradient(135deg, var(--accent), #ff9f1a);
    box-shadow:0 8px 18px rgba(255,106,0,.35), inset 0 1px 0 rgba(255,255,255,.25); }

  .video-wrap{position:fixed; inset:0; width:100vw; height:100svh; height:100dvh;}
  video{ position:absolute; left:0; top:0; width:100%; height:100%;
         object-fit:cover; object-position:center; background:#000; transition:opacity .9s ease; }
  .fade-out{ opacity:0; }

  .clue-card{ width:min(820px,92vw); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.12);
    border-radius:16px; padding:20px; box-shadow:0 12px 28px rgba(0,0,0,.45); }
  .clue-title{ font-weight:900; margin-bottom:6px }
  .clue-text{ white-space:pre-wrap; line-height:1.65 }

  /* --- Additions (safe, scoped) --- */
  .stack{display:flex; flex-direction:column; align-items:center; gap:14px; margin-top:14px;}
  .ghost{display:none; opacity:0; transition:opacity .6s ease, transform .6s ease; transform:translateY(8px);}
  .ghost.show{display:inline-flex; opacity:1; transform:translateY(0);}
  .btn-ghost{ 
    -webkit-tap-highlight-color:transparent; 
    display:inline-flex; align-items:center; gap:10px;
    padding:14px 18px; border:0; border-radius:14px; font-weight:900; font-size:1.05rem;
    color:#0b0f14; background:linear-gradient(135deg, #ff9f1a, #ffd166);
    box-shadow:0 8px 18px rgba(255,159,26,.35), inset 0 1px 0 rgba(255,255,255,.35);
    letter-spacing:0.3px;
  }
  .spider{filter: drop-shadow(0 2px 2px rgba(0,0,0,.35));}
</style>
</head>
<body>

<div id="gate" class="layer">
  <div class="card">
    <div class="title">üéÉ Halloween Hunt Start</div>
    <div class="meta">Tap the button to start the <strong>October 2025 Halloween Scavenger Hunt Experience</strong>. Winner gets a <strong>$25 gift card!</strong></div>
    <button id="start" class="btn"><span>üï∑Ô∏è</span> Start the Spook</button>
    <div class="note">Note: turn your sound up!</div>
  </div>
</div>

<div id="player" class="layer">
  <div class="video-wrap">
    <video id="vid" src="./halloween.mp4" playsinline preload="auto"></video>
  </div>
</div>

<!-- NEW: Intermediate intro video layer shown after "Continue the Spook" -->
<div id="intro" class="layer" style="display:none;">
  <div class="video-wrap">
    <video id="introVid" src="./halloween-hunt-intro.MP4" playsinline preload="auto"></video>
  </div>
</div>

<div id="content" class="layer">
  <div class="clue-card">
    <div class="clue-title">üëª Your Hunt Begins</div>
    <div id="clueBlock">
      <div class="clue-text">Welcome to the October 2025 Halloween Scavenger Hunt.

How To Play:
Find a hidden QR code, solve its puzzle, and unlock a clue to the next QR code.
First one to solve all the clues will find the $25 gift card hidden in the end.

Rules:
There are no QR codes in
- Any bedrooms.
- The office.
So, no need to go in those rooms to find any.</div>

      <div class="stack">
        <button id="continueSpook" class="btn-ghost">
          <span class="spider">üï∑Ô∏è</span> Continue the Spook
        </button>
      </div>
    </div>

    <div id="hubBlock" class="stack ghost">
      <button id="enterHub" class="btn-ghost">
        üéÉ Enter the Main Hub
      </button>
    </div>
  </div>
</div>

<script>
const gate = document.getElementById('gate');
const player = document.getElementById('player');
const content = document.getElementById('content');
const startBtn = document.getElementById('start');
const vid = document.getElementById('vid');

const intro = document.getElementById('intro');
const introVid = document.getElementById('introVid');

const VIDEO_LEN_MS = 25000;
let fadeTimeout, endTimeout;

function show(el){ el.style.display='flex'; }
function hide(el){ el.style.display='none'; }
function clearTimers(){ clearTimeout(fadeTimeout); clearTimeout(endTimeout); }

function revealClue(){
  try{ vid.pause(); }catch(e){}
  hide(player);
  show(content);
  requestAnimationFrame(()=> content.classList.add('reveal'));
}

function scheduleFinish(){
  const FADE_MS = 900;
  clearTimers();
  fadeTimeout = setTimeout(()=> vid.classList.add('fade-out'), Math.max(0, VIDEO_LEN_MS - FADE_MS));
  endTimeout = setTimeout(revealClue, VIDEO_LEN_MS + 120);
}

function begin(){
  hide(gate);
  show(player);
  try{ vid.currentTime = 0; }catch(e){}
  vid.classList.remove('fade-out');

  const p = vid.play();
  if (p && typeof p.then === 'function'){
    p.then(()=> scheduleFinish())
     .catch(()=>{
       vid.addEventListener('click', ()=> vid.play().then(()=> scheduleFinish()), { once:true });
     });
  } else {
    scheduleFinish();
  }
}

function setVH(){
  const h = Math.max(window.innerHeight, document.documentElement.clientHeight || 0);
  const wraps = document.querySelectorAll('.video-wrap');
  wraps.forEach(w => w.style.height = h + 'px');
}
window.addEventListener('resize', setVH);
window.addEventListener('orientationchange', setVH);
setVH();

startBtn.addEventListener('click', begin);
vid.addEventListener('ended', revealClue);

const clueBlock = document.getElementById('clueBlock');
const hubBlock  = document.getElementById('hubBlock');
const continueSpook = document.getElementById('continueSpook');
const enterHub = document.getElementById('enterHub');

// Updated flow: Continue -> play intro video -> show hub button
if (continueSpook && hubBlock && clueBlock && intro && introVid){
  continueSpook.addEventListener('click', () => {
    // Hide text + first button
    clueBlock.style.display = 'none';
    // Show intro layer and play video
    show(intro);
    try { introVid.currentTime = 0; } catch(e){}
    const p2 = introVid.play();
    if (p2 && typeof p2.then === 'function'){
      p2.then(()=>{}).catch(()=>{
        // If autoplay blocked, allow user to start by tapping the video
        introVid.addEventListener('click', () => introVid.play(), { once:true });
      });
    }
  });

  // When intro ends, hide it and show the hub button with fade-in
  introVid.addEventListener('ended', () => {
    hide(intro);
    hubBlock.classList.add('show');
    hubBlock.style.display = 'flex';
  });
}

enterHub.addEventListener('click', () => {
  window.location.href = 'https://murresta13.github.io/main-hub/?v=3';
});
</script>
</body>
</html>
