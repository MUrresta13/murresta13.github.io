<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>QR Clue ‚Äî Halloween</title>
<style>
  :root{
    --bg:#0b0f14;
    --card: rgba(255,255,255,.06);
    --stroke: rgba(255,255,255,.12);
    --text:#f3f6fb;
    --accent:#ff6a00; /* pumpkin orange */
    --accent2:#8a2be2; /* eerie purple */
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0}
  body{
    background: radial-gradient(1200px 600px at 50% -10%, #111627 0%, var(--bg) 60%);
    color: var(--text);
    font-family:-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    display:flex;align-items:center;justify-content:center;padding:20px
  }
  .wrap{width:100%;max-width:760px}
  .card{
    background:var(--card);
    border:1px solid var(--stroke);
    border-radius:16px;
    padding:20px;
    box-shadow:0 12px 28px rgba(0,0,0,.35)
  }
  .hidden{display:none}
  .title{font-size:1.35rem;font-weight:900;letter-spacing:.3px;margin-bottom:8px}
  .meta{opacity:.85;margin:.25rem 0 1rem}
  .btn{
    -webkit-tap-highlight-color:transparent;
    display:inline-flex;align-items:center;gap:10px;
    padding:14px 18px;border:0;border-radius:14px;
    font-weight:800;font-size:1.05rem;
    color:#1a1a1a;background:linear-gradient(135deg, var(--accent), #ff9f1a);
    box-shadow:0 8px 18px rgba(255,106,0,.35), inset 0 1px 0 rgba(255,255,255,.25);
  }
  .btn:active{transform:translateY(1px);opacity:.98}
  .btn .icon{font-size:1.2rem}
  .btn.alt{
    background: linear-gradient(135deg, var(--accent2), #b77bff);
    color:white;
    box-shadow:0 8px 18px rgba(138,43,226,.35), inset 0 1px 0 rgba(255,255,255,.18);
  }
  video{
    width:100%;max-width:720px;border-radius:14px;background:#000;
    transition: opacity .9s ease;
  }
  .fade-out{opacity:0}
  .clue{white-space:pre-wrap;line-height:1.6;margin-top:10px}
  .code{opacity:.9;font-style:italic;margin-top:8px}
  .footer{opacity:.75;margin-top:8px;font-size:.95rem}
</style>
</head>
<body>
  <!-- Gate (required for iOS to allow media with sound) -->
  <div id="gate" class="wrap">
    <div class="card" style="text-align:center">
      <div class="title">üéÉ Halloween Start</div>
      <div class="meta">Tap the button to play a short video. It will fade out, then your clue appears.</div>
      <button id="start" class="btn"><span class="icon">üï∑Ô∏è</span> Start the Spook</button>
      <div class="footer">Tip: On iPhone, sound/video plays only after a tap by design.</div>
    </div>
  </div>

  <!-- Player -->
  <div id="player" class="wrap hidden">
    <div class="card">
      <!-- IMPORTANT: Put your trimmed 25s MP4 next to this file and name it exactly "halloween.mp4" -->
      <video id="vid" src="./halloween.mp4" playsinline preload="auto"></video>
      <div id="status" class="meta">Loading‚Ä¶</div>
      <button id="restart" class="btn alt hidden"><span class="icon">üîÅ</span> Replay</button>
    </div>
  </div>

  <!-- Content -->
  <div id="content" class="wrap hidden">
    <div class="card">
      <div class="title">?</div>
      <div class="meta">Clue: 25/30 ‚Ä¢ Difficulty: 5/6</div>
      <div class="clue">In the sacred alcove where prayers ascend,
A box of reverence, where solace blends. Gaze upwards,
where angels might tread, on the right-hand path, a clue is spread.

Beyond eye's reach, a festive light gleams,
Ascend to the top, where the mystery teems.</div>
      <div class="code">Code: SugarPlumDreams (December 17th)</div>
    </div>
  </div>

<script>
const gate = document.getElementById('gate');
const player = document.getElementById('player');
const content = document.getElementById('content');
const statusEl = document.getElementById('status');
const startBtn = document.getElementById('start');
const restartBtn = document.getElementById('restart');
const vid = document.getElementById('vid');

const VIDEO_LEN_MS = 25000; // 25 seconds
let fadeTimeout = null;
let endTimeout  = null;

function show(el){ el.classList.remove('hidden'); }
function hide(el){ el.classList.add('hidden'); }
function status(msg){ statusEl.textContent = msg; }

function begin(){
  hide(gate); show(player);
  status('Loading‚Ä¶');

  // Ensure video starts from the beginning
  try { vid.pause(); vid.currentTime = 0; } catch(_){}

  const playPromise = vid.play();
  if (playPromise && typeof playPromise.then === 'function') {
    playPromise.then(()=>{
      status('Playing‚Ä¶');
      scheduleFadeAndEnd();
    }).catch(e=>{
      status('Tap video to play (iOS policy).');
    });
  } else {
    // Older browsers
    scheduleFadeAndEnd();
  }
}

function scheduleFadeAndEnd(){
  // Fade out slightly before end to feel smooth
  const FADE_MS = 900; // match CSS transition
  clearTimeout(fadeTimeout); clearTimeout(endTimeout);

  fadeTimeout = setTimeout(()=>{
    vid.classList.add('fade-out');
  }, Math.max(0, VIDEO_LEN_MS - FADE_MS));

  endTimeout = setTimeout(()=>{
    // Stop and reveal content
    try { vid.pause(); } catch(_){}
    hide(player); show(content);
    // reset fade for potential replay
    vid.classList.remove('fade-out');
    restartBtn.classList.remove('hidden');
  }, VIDEO_LEN_MS + 120);
}

vid.addEventListener('canplaythrough', ()=> status('Ready. Tap Start.'));
vid.addEventListener('play', ()=> status('Playing‚Ä¶'));
vid.addEventListener('ended', ()=>{
  // If the file ends before 25s, still reveal content
  hide(player); show(content);
  vid.classList.remove('fade-out');
  restartBtn.classList.remove('hidden');
});

startBtn.addEventListener('click', begin);
restartBtn.addEventListener('click', ()=>{
  hide(content); show(player);
  begin();
});
</script>
</body>
</html>
